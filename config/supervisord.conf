[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=10MB
logfile_backups=3
loglevel=info
pidfile=/var/run/supervisord.pid

; ── 1. KasmVNC (Xvnc virtual display + VNC server + web client) ──────────────
; Replaces the previous xvfb + x11vnc + novnc + websockify stack.
[program:kasmvnc]
priority=10
user=developer
command=/usr/local/bin/start-kasmvnc.sh
autostart=true
autorestart=true
environment=HOME="/home/developer"
stdout_logfile=/var/log/supervisor/kasmvnc.log
stderr_logfile=/var/log/supervisor/kasmvnc.log
stdout_logfile_maxbytes=5MB
stderr_logfile_maxbytes=5MB

; ── 2. XFCE desktop + Antigravity autostart ──────────────────────────────────
[program:desktop]
priority=20
user=developer
command=/usr/local/bin/start-desktop.sh
autostart=true
autorestart=true
environment=DISPLAY=":1",HOME="/home/developer"
stdout_logfile=/var/log/supervisor/desktop.log
stderr_logfile=/var/log/supervisor/desktop.log
stdout_logfile_maxbytes=5MB
stderr_logfile_maxbytes=5MB

; ── 3. Nginx (public endpoint, reverse proxy to KasmVNC) ─────────────────────
[program:nginx]
priority=30
command=nginx -g "daemon off;"
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/nginx.log
stderr_logfile=/var/log/supervisor/nginx.log
stdout_logfile_maxbytes=5MB
stderr_logfile_maxbytes=5MB
